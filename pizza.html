<!DOCTYPE html>
<html>
<head></head>
<body>
<div class='label'>Select pizza toppings</div> 
	<img src="images/circle_icon.png" width="125px">
	<img src="images/green-circle.png" width="30px" id='pepperoni_image'>
	<img src="images/green-circle.png" width="30px" id='sausage_image'>
	<img src="images/green-circle.png" width="30px" id='jalapenos_image'>
	<img src="images/green-circle.png" width="30px" id='onions_image'>
	<img src="images/green-circle.png" width="30px" id='red_peppers_image'>
	<img src="images/green-circle.png" width="30px" id='xcheese_image'>
	<ul class='checkbox'> 
	  <li><input checked="true" type='checkbox' onclick='toggle_topping(this)' id='pepperoni' value='pepperoni' title='Pepperoni'/>Pepperoni</li> 
	  <li><input checked="true" type='checkbox' onclick='toggle_topping(this)' id='sausage' value='sausage'  title='Sausage'/>Sausage</li> 
	  <li><input checked="true" type='checkbox' onclick='toggle_topping(this)' id='jalapenos' value='jalapenos' title='Mushrooms'/>Jalapenos</li> 
	  <li><input checked="true" type='checkbox' onclick='toggle_topping(this)' id='onions' value='onions' title='Onions'/>Onions</li> 
	  <li><input checked="true" type='checkbox' onclick='toggle_topping(this)' id='red_peppers' value='red_peppers' title='Green Peppers'/>Red Peppers</li> 
	  <li><input checked="true" type='checkbox' onclick='toggle_topping(this)' id='xcheese' value='xcheese' title='Extra Cheese'/>Extra Cheese</li> 
	</ul>
	commnets :
	<input id='comments' type='text' value='' onkeypress='change_comments(this)' size='100'>
	<script src="https://www.promisejs.org/polyfills/promise-4.0.0.js"></script>
	<script type='text/javascript' src='./bundle.js'></script>
	<script type='text/javascript'>
	data = {
		toppings:{
			pepperoni: true,
			sausage: true,
			jalapenos: true,
			onions: true,
			red_peppers: true,
			xcheese: true
		},
		comments: ''
	};
	var c = new CollabrifyClient({
		application_id: '4891981239025664',
		user_id: 'collabrify.tester@gmail.com'
	});
	c.createSession({
		name: 'pizza_demo',// + Math.random().toString(),
		password: 'password',
		tags: ['tag8'],
		startPaused: false
	})
	.catch(function(){
		console.log('listing sessions');
		c.listSessions(['tag8'])
		.then(function(sessions){
			console.log(sessions);
			c.joinSession({session:sessions[0], password: 'password'});
		});
	});

	c.on('event',function(event){
		console.log(event);
		data = event.data
		for(var key in data.toppings){
			document.getElementById(key).checked = data.toppings[key]
			if(document.getElementById(key+'_image'))
				document.getElementById(key+'_image').style.visibility = (data.toppings[key] ? "" : "hidden")
		}
		document.getElementById('comments').value = data.comments

	});

	c.on('user_joined', function(user){
		alert(user);
	});

	// change_comments = function(com){
	// 	alert('change comments');
	// 	data.comments = com.value;
	// 	c.broadcast(data)
	// }

	toggle_topping = function (cb) {
		document.getElementById(cb.value+'_image').style.visibility = (cb.checked ? "": "hidden")
		data.toppings[cb.value] = cb.checked
		data.comments = document.getElementById('comments').value
		c.broadcast(data)
	};
	</script>
</body>

</html>