<!DOCTYPE html>
<html>
<head>
    <style>
        #remoteVideos video {
            height: 100px;
        }
        #localVideo {
            height: 100px;
        }
    </style>
</head>
<body>
<div class='label'>Select pizza toppings</div> 
	<img src="images/circle_icon.png" width="125px">
	<img src="images/green-circle.png" width="30px" id='pepperoni_image'>
	<img src="images/green-circle.png" width="30px" id='sausage_image'>
	<img src="images/green-circle.png" width="30px" id='jalapenos_image'>
	<img src="images/green-circle.png" width="30px" id='onions_image'>
	<img src="images/green-circle.png" width="30px" id='red_peppers_image'>
	<img src="images/green-circle.png" width="30px" id='xcheese_image'>
	<ul class='checkbox'> 
	  <li><input checked="true" type='checkbox' onclick='toggle_topping(this)' id='pepperoni' value='pepperoni' title='Pepperoni'/>Pepperoni</li> 
	  <li><input checked="true" type='checkbox' onclick='toggle_topping(this)' id='sausage' value='sausage'  title='Sausage'/>Sausage</li> 
	  <li><input checked="true" type='checkbox' onclick='toggle_topping(this)' id='jalapenos' value='jalapenos' title='Mushrooms'/>Jalapenos</li> 
	  <li><input checked="true" type='checkbox' onclick='toggle_topping(this)' id='onions' value='onions' title='Onions'/>Onions</li> 
	  <li><input checked="true" type='checkbox' onclick='toggle_topping(this)' id='red_peppers' value='red_peppers' title='Green Peppers'/>Red Peppers</li> 
	  <li><input checked="true" type='checkbox' onclick='toggle_topping(this)' id='xcheese' value='xcheese' title='Extra Cheese'/>Extra Cheese</li> 
	</ul>
	<div></div>
	<video id='localVideo'></video>
	<div id="remoteVideos"></div>
	<script src="http://simplewebrtc.com/latest.js"></script>
	<script src="https://www.promisejs.org/polyfills/promise-4.0.0.js"></script>
	<script type='text/javascript' src='./collabrify-3.0.0.js'></script>
	<script type='text/javascript'>
	data = {
		toppings:{
			pepperoni: true,
			sausage: true,
			jalapenos: true,
			onions: true,
			red_peppers: true,
			xcheese: true
		}
	};
	var c = new CollabrifyClient({
		application_id: '4891981239025664',
		user_id: 'collabrify.tester@gmail.com'
	});
	c.createSession({
		name: 'pizza_demo5',// + Math.random().toString(),
		password: 'password',
		tags: ['pizzza3'],
		startPaused: false
	})
	.catch(function(){
		console.log('listing sessions');
		c.listSessions(['pizzza3'])
		.then(function(sessions){
			console.log(sessions);
			c.joinSession({session:sessions[0], password: 'password'});
		});
	});

	c.on('event',function(event){
		for(var key in event.data.toppings){
			data.toppings[key] = event.data.toppings[key]
			document.getElementById(key).checked = data.toppings[key]
			if(document.getElementById(key+'_image'))
				document.getElementById(key+'_image').style.visibility = (data.toppings[key] ? "" : "hidden")
		}
	});

	c.on('user_joined', function(user){
		alert(user);
	});

	toggle_topping = function (cb) {
		document.getElementById(cb.value+'_image').style.visibility = (cb.checked ? "": "hidden");
		data.toppings[cb.value] = cb.checked;
		payload = {toppings:{}};
		payload.toppings[cb.value] = cb.checked;
		c.broadcast(payload);
	};

	var webrtc = new SimpleWebRTC({
	    // the id/element dom element that will hold "our" video
	    localVideoEl: 'localVideo',
	    // the id/element dom element that will hold remote videos
	    remoteVideosEl: 'remoteVideos',
	    // immediately ask for camera access
	    autoRequestMedia: true
	});
	webrtc.on('readyToCall', function () {
    	// you can name it anything
    	webrtc.joinRoom('potleepizza-5279308758230457');
	});
	</script>
</body>

</html>